- if @edit
  - url = url_for(:action => 'rbac_role_field_changed',
                  :id     => "#{@edit[:role_id] || "new"}")
= render :partial => "layouts/flash_msg"
#main_div
  %dl.col2
    %dd
      %fieldset
        %p.legend=_("Role Information")
        %table.style1
          %tr
            %td.key=_("Name")
            %td
              - if !@edit
                = h(@role.name)
              - else
                = text_field_tag("name",
                                 @edit[:new][:name],
                                 :maxlength         => 50,
                                 "data-miq_observe" => {:interval => '.5', :url => url}.to_json)
                = javascript_tag(javascript_focus('name'))
          %tr
            %td.key=_("VM & Template Access Restriction")
            %td
              - if !@edit
                - if @role.settings.kind_of?(Hash) && @role.settings.fetch_path(:restrictions, :vms)
                  = h(MiqUserRole::RESTRICTIONS[@role.settings.fetch_path(:restrictions, :vms)])
                - else
                  =_("None")
              - else
                = select_tag('vm_restriction',
                             options_for_select([[_("None"), _("none")]] + MiqUserRole::RESTRICTIONS.invert.sort { |a, b| a[0].downcase <=> b[0].downcase },
                             @edit[:new][:vm_restriction].to_sym),
                             "data-miq_observe" => {:url => url}.to_json)
          - unless @edit
            %tr
              %td.key=_("Groups Using this Role")
              %td{:style => "padding: 0px"}
                %table{:cellpadding => "0", :cellspacing => "0"}
                  - @role.miq_groups.collect { |g| g }.sort { |a, b| a.description.downcase <=> b.description.downcase }.each do |g|
                    %tr{:onclick => "cfmeDynatree_activateNode('rbac_tree', 'g-#{to_cid(g.id)}');",
                        :onmouseover => "this.style.cursor='pointer'",
                        :title => _("View this Group")}
                      %td.image
                        %img{:src => "/images/icons/new/miq_group.png"}/
                      %td
                        = h(g.description)
    %dd
      %fieldset
        - temp = @edit ? _("Editing") : _("Read Only")
        %p.legend=_("Product Features (%s)") % temp
        #features_treebox{:style => "width:100%;height:#{@winH - 435}px;color:#000"}
        = render(:partial => "layouts/dynatree",
                 :locals  => {:tree_id        => "features_treebox",
                              :tree_name      => "features_tree",
                              :json_tree      => @temp[:features_tree],
                              :checkboxes     => true,
                              :three_checks   => true,
                              :check_url      => "/ops/rbac_role_field_changed/",
                              :disable_checks => @edit.nil?,
                              :oncheck        => @edit.nil? ? nil : "cfmeOnClick_RoleFeatureCheck",
                              :open_close_all_on_dbl_click => true})
      &nbsp;&nbsp;*
      =_("Double click a feature to open/close all children.")
