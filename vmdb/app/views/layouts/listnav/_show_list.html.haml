- if !@def_searches.blank? || !@my_searches.blank?
  .panel-group#accordion
    .panel.panel-default
      .panel-heading
        %h4.panel-title
          - unless @def_searches.blank?
            = link_to(_("Filters"),
                      "#collapseOne",
                      "data-toggle" => "collapse", 
                      "data-parent" => "#accordion")
            - if @panels["#{@view.db}_def_searches"].nil?
              - @panels["#{@view.db}_def_searches"] = true

      #collapseOne.panel-collapse.collapse.in
        .panel-body
          %ul.nav.nav-pills.nav-stacked
            - @def_searches.each do |search|
              - if (!@default_search.blank? && @default_search.name == search.name) || (@default_search.blank? && search.id.to_i == 0)
                - # highlight if default is selected, or first time in
                - if @edit && @edit[:expression] && ((@edit[:expression][:selected].nil? && @edit[:selected].nil?) || (!@edit[:expression][:selected].nil? && @edit[:expression][:selected][:id] == search.id.to_i && !@edit[:custom_search]))
                  - li_class = "active"
                - else
                  - li_class = ""
              - elsif @edit && @edit[:expression] && ((@edit[:expression][:selected] && @edit[:expression][:selected][:id] == 0 && search.id.to_i == 0) || (@edit[:expression][:selected] && @edit[:expression][:selected][:name] == search.name && !@edit[:custom_search]))
                - li_class = "active"
              - else
                - li_class = ""
              %li{:class => "#{li_class}"}
                - if (!@default_search.blank? && @default_search.name == search.name) || (@default_search.blank? && search.id.to_i == 0 && @settings[:default_search] && @settings[:default_search][@edit[@expkey][:exp_model].to_s.to_sym] && @settings[:default_search][@edit[@expkey][:exp_model].to_s.to_sym].to_i == 0)
                  - search_name = search.description << " " << "(Default)"
                - else
                  - search_name = search.description
                = link_to(search_name.html_safe,
                  {:action => 'listnav_search_selected', :id => search.id, :button => "apply"},
                  :remote  => true,
                  :title   => _("Apply this filter"),
                  :onclick => "return miqCheckForChanges()")

    - unless @my_searches.blank?
      .panel.panel-default
        .panel-heading
          %h4.panel-title
            = link_to(_("My Filters"),
                      "#collapseTwo",
                      "data-toggle" => "collapse", 
                      "data-parent" => "#accordion")
          - if @panels["#{@view.db}_my_searches"].nil?
            - @panels["#{@view.db}_my_searches"] = true

        #collapseTwo.panel-collapse.collapse
          .panel-body
            %ul.nav.nav-pills.nav-stacked
              - @my_searches.each do |search|
                - if !@default_search.blank? && @default_search.name == search.name
                  - if @edit && @edit[:expression] && ((@edit[:expression][:selected].nil? && @edit[:selected].nil?) || (!@edit[:expression][:selected].nil? && @edit[:expression][:selected][:id] == search.id.to_i && !@edit[:custom_search]))
                    - li_class = "active"
                  - else
                    - li_class = ""
                - elsif @edit && @edit[:expression] && ((@edit[:expression][:selected].nil? && search.id.to_i == 0) || (@edit[:expression][:selected] && @edit[:expression][:selected][:name] == search.name && !@edit[:custom_search]))
                  - li_class = "active"
                - else
                  - li_class = ""
                - if !@default_search.blank? && @default_search.name == search.name
                  - search_name = search.description
                - else
                  - search_name = search.description

                %li{:class => "#{li_class}"}
                  = link_to(search_name.html_safe,
                    {:action => 'listnav_search_selected', :id => search.id, :button => "apply"},
                    :remote  => true,
                    :title   => _("Apply this filter"),
                    :onclick => "return miqCheckForChanges()")

  - if @edit && @edit[:expression] && @edit[:expression][:selected] && (!@settings[:default_search] || (@settings[:default_search] && @edit[:expression][:selected][:id].to_i != @settings[:default_search][@edit[@expkey][:exp_model].to_s.to_sym].to_i) || (!@settings[:default_search][@edit[@expkey][:exp_model].to_s.to_sym]))
    - t = _('Set the current filter as my default')
    = link_to(button_tag("Set Default", 
                         :class =>"btn btn-default pull-right",
                         :alt => t),
            {:action => "save_default_search", :id => @edit[:expression][:selected][:id].to_i},
            "data-miq_sparkle_on"  => true,
            "data-miq_sparkle_off" => true,
            :remote                => true,
            :title                 => t)
  - else
    = button_tag("Set Default",
                 :class => "btn btn-default btn-disabled pull-right",
                 :title => _("Select a filter to set it as my default"))
